<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Analytics</title>

<style>
:root{
  --ink:#0f172a;
  --muted:#64748b;

  --blue:#cfe9ff;
  --mint:#d9fbe8;
  --pink:#ffe0ef;
  --lav:#efe6ff;

  --radius:24px;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:white;
  color:var(--ink);
  overflow:hidden;
}

.slider{
  display:flex;
  height:100vh;
  width:100vw;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  scroll-behavior:smooth;
}

.slide{
  flex:0 0 100%;
  scroll-snap-align:start;
  padding:22px;
  box-sizing:border-box;
  overflow-y:auto;
}

.sectionTitle{
  font-size:22px;
  font-weight:900;
  margin-bottom:18px;
}

.card{
  border-radius:var(--radius);
  padding:18px;
  margin-bottom:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
}

.blue{ background:var(--blue); }
.mint{ background:var(--mint); }
.pink{ background:var(--pink); }
.lav{ background:var(--lav); }

.bigNumber{
  font-size:32px;
  font-weight:900;
}

.sub{
  font-size:13px;
  color:var(--muted);
  margin-top:4px;
}

.pillRow{
  margin-top:14px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.pill{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 16px;
  background:white;
  border-radius:999px;
  font-weight:600;
  box-shadow:0 6px 16px rgba(0,0,0,.06);
}

.navBar{
  position:fixed;
  top:12px;
  left:12px;
  right:12px;
  display:flex;
  justify-content:space-between;
  z-index:10;
}

.navBtn{
  padding:8px 14px;
  border-radius:999px;
  background:#0f172a;
  color:white;
  font-weight:700;
  font-size:13px;
  border:none;
}

.dots{
  position:fixed;
  bottom:18px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
}

.dot{
  width:8px;
  height:8px;
  border-radius:50%;
  background:#cbd5e1;
  transition:.2s;
}

.dot.active{
  background:#0f172a;
}
</style>
</head>
<body>

<div class="navBar">
  <button class="navBtn" onclick="goBack()">Back</button>
  <button class="navBtn" onclick="copyAll()">Copy All</button>
</div>

<div class="slider" id="slider">

  <!-- Slide 1 -->
  <div class="slide">
    <div class="sectionTitle">Today Snapshot</div>

    <div class="card mint">
      <div class="bigNumber" id="prodMin">0</div>
      <div class="sub">Productive Minutes</div>
    </div>

    <div class="card pink">
      <div class="bigNumber" id="relaxMin">0</div>
      <div class="sub">Relax Minutes</div>
    </div>

    <div class="card blue">
      <div class="bigNumber" id="balance">0</div>
      <div class="sub">Balance</div>
    </div>
  </div>

  <!-- Slide 2 -->
  <div class="slide">
    <div class="sectionTitle">Top Activities</div>
    <div class="pillRow" id="topActivities"></div>
  </div>

  <!-- Slide 3 -->
  <div class="slide">
    <div class="sectionTitle">Locations</div>
    <div class="pillRow" id="locations"></div>
  </div>

  <!-- Slide 4 -->
  <div class="slide">
    <div class="sectionTitle">Recent Sessions</div>
    <div class="pillRow" id="recent"></div>
  </div>

</div>

<div class="dots">
  <div class="dot active"></div>
  <div class="dot"></div>
  <div class="dot"></div>
  <div class="dot"></div>
</div>

<script>
function load(){
  try{
    const raw = localStorage.getItem("brain_state_v1");
    if(!raw) return null;
    return JSON.parse(raw);
  }catch(e){
    return null;
  }
}

function formatMin(n){
  return (Number(n)||0).toFixed(1)+"m";
}

function goBack(){
  window.location.href="index.html";
}

function copyAll(){
  const raw = localStorage.getItem("brain_state_v1");
  if(!raw){
    alert("No data to copy.");
    return;
  }
  navigator.clipboard.writeText(raw)
    .then(()=>alert("All-time data copied."))
    .catch(()=>alert("Copy failed."));
}

function topActivities(sessions){
  const map={};
  sessions.forEach(s=>{
    const dur=Number(s.durationMin)||0;
    const acts=(s.active && s.active.activity) ? s.active.activity : [];
    acts.forEach(a=>{
      map[a]=(map[a]||0)+dur;
    });
  });
  return Object.entries(map).sort((a,b)=>b[1]-a[1]).slice(0,5);
}

function agg(sessions,key){
  const map={};
  sessions.forEach(s=>{
    const dur=Number(s.durationMin)||0;
    const val=s.active ? s.active[key] : null;
    if(!val) return;
    map[val]=(map[val]||0)+dur;
  });
  return Object.entries(map).sort((a,b)=>b[1]-a[1]).slice(0,5);
}

document.addEventListener("DOMContentLoaded",()=>{
  const brain=load();
  if(!brain){
    alert("No data found.");
    return;
  }

  document.getElementById("prodMin").textContent=formatMin(brain.productiveMins);
  document.getElementById("relaxMin").textContent=formatMin(brain.relaxMins);
  document.getElementById("balance").textContent="$"+(brain.balance||0).toFixed(2);

  const sessions=brain.sessions||[];

  const actContainer=document.getElementById("topActivities");
  topActivities(sessions).forEach(([name,min])=>{
    const div=document.createElement("div");
    div.className="pill";
    div.innerHTML=`<span>${name}</span><span>${formatMin(min)}</span>`;
    actContainer.appendChild(div);
  });

  const locContainer=document.getElementById("locations");
  agg(sessions,"location").forEach(([name,min])=>{
    const div=document.createElement("div");
    div.className="pill";
    div.innerHTML=`<span>${name}</span><span>${formatMin(min)}</span>`;
    locContainer.appendChild(div);
  });

  const recentContainer=document.getElementById("recent");
  sessions.slice(-5).reverse().forEach(s=>{
    const div=document.createElement("div");
    div.className="pill";
    div.innerHTML=`<span>${s.active?.location||"Unknown"}</span><span>${formatMin(s.durationMin)}</span>`;
    recentContainer.appendChild(div);
  });

  const slider=document.getElementById("slider");
  const dots=document.querySelectorAll(".dot");

  slider.addEventListener("scroll",()=>{
    const index=Math.round(slider.scrollLeft/window.innerWidth);
    dots.forEach((d,i)=>d.classList.toggle("active",i===index));
  });
});
</script>

</body>
</html>